<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Me Lembre Depois</title>

<link rel="manifest" href="manifest.json">

<style>

:root{
--bg:#f2f2f7;
--card:#fff;
--text:#000;
}

@media (prefers-color-scheme: dark){
:root{
--bg:#000;
--card:#1c1c1e;
--text:#fff;
}
}

body{
font-family:-apple-system;
background:var(--bg);
color:var(--text);
margin:0;
padding:20px;
}

.card{
background:var(--card);
border-radius:16px;
padding:14px;
margin-top:12px;
position:relative;
transition:.2s;
touch-action:pan-y;
}

.hoje{border-left:6px solid #34c759;}
.proximo{border-left:6px solid #007aff;}
.passado{opacity:.5;}

.fab{
position:fixed;
bottom:30px;
right:20px;
width:60px;
height:60px;
border-radius:50%;
background:#007aff;
color:white;
font-size:28px;
border:none;
}

.modal-bg{
position:fixed;
top:0;
left:0;
right:0;
bottom:0;
background:rgba(0,0,0,.4);
display:none;
align-items:center;
justify-content:center;
}

.modal{
background:var(--card);
padding:20px;
border-radius:20px;
width:90%;
max-width:400px;
}

input{
width:100%;
padding:12px;
margin-top:10px;
border-radius:10px;
border:1px solid #444;
background:var(--card);
color:var(--text);
}

button{
margin-top:10px;
padding:12px;
width:100%;
border:none;
border-radius:12px;
}

.salvar{background:#007aff;color:white;}
.cancelar{background:#ff3b30;color:white;}

</style>
</head>

<body>

<h2>Me Lembre Depois</h2>

<div id="lista"></div>

<button class="fab" onclick="abrirModal()">+</button>

<div class="modal-bg" id="modal">
<div class="modal">
<input id="texto" placeholder="Digite algo...">
<input type="datetime-local" id="data">
<button class="salvar" onclick="salvarLembrete()">Salvar</button>
<button class="cancelar" onclick="fecharModal()">Cancelar</button>
</div>
</div>

<script>

let lembretes = JSON.parse(localStorage.getItem("lembretes")||"[]")
let editando=null

function vibrar(){
if(navigator.vibrate) navigator.vibrate(30)
}

function classeData(data){

let hoje=new Date()
let futuro=new Date(data)

let diff=Math.ceil((futuro-hoje)/(1000*60*60*24))

if(diff<0) return "passado"
if(diff===0) return "hoje"
return "proximo"
}

function salvarStorage(){
localStorage.setItem("lembretes",JSON.stringify(lembretes))
render()
}

function abrirModal(){
document.getElementById("modal").style.display="flex"
}

function fecharModal(){
document.getElementById("modal").style.display="none"
editando=null
}

function salvarLembrete(){

let texto=document.getElementById("texto").value
let data=document.getElementById("data").value

if(!texto||!data)return

if(editando){
let l=lembretes.find(x=>x.id===editando)
l.texto=texto
l.data=data
}else{
lembretes.push({id:Date.now(),texto,data})
}

vibrar()
document.getElementById("texto").value=""
fecharModal()
salvarStorage()
}

function editar(id){
let l=lembretes.find(x=>x.id===id)
document.getElementById("texto").value=l.texto
document.getElementById("data").value=l.data
editando=id
abrirModal()
}

function apagar(id){
lembretes=lembretes.filter(l=>l.id!==id)
vibrar()
salvarStorage()
}

function swipe(card,id){

let startX=0

card.addEventListener("touchstart",e=>{
startX=e.touches[0].clientX
})

card.addEventListener("touchmove",e=>{
let dx=e.touches[0].clientX-startX
if(dx<-60){
card.style.transform="translateX(-100%)"
setTimeout(()=>apagar(id),200)
}
})
}

function render(){

let div=document.getElementById("lista")
div.innerHTML=""

lembretes.sort((a,b)=>new Date(a.data)-new Date(b.data))

lembretes.forEach(l=>{

let classe=classeData(l.data)

div.innerHTML+=`
<div class="card ${classe}" id="c${l.id}">
<b>ðŸ“… ${l.texto}</b><br>
${new Date(l.data).toLocaleString()}
<button onclick="editar(${l.id})">Editar</button>
</div>`
})

lembretes.forEach(l=>{
let card=document.getElementById("c"+l.id)
swipe(card,l.id)
})
}

render()

if('serviceWorker' in navigator){
navigator.serviceWorker.register('service-worker.js')
}

</script>

</body>
</html>
